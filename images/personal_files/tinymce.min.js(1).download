angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(e,t,n,i,r,o,u){return(o=o||{}).baseUrl&&(tinymce.baseURL=o.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(c,a,s,d){if(i.tinymce){var m,f,l=d[0],$=d[1]||null,v={debounce:!0},g=function(t){var n=t.getContent({format:v.format}).trim();n=r.trustAsHtml(n),l.$setViewValue(n),e.$$phase||c.$digest()},y=u.getUniqueId();s.$set("id",y),m={},angular.extend(m,c.$eval(s.uiTinymce));var b,p=function(e){n.cancel(b),b=n(function(){return function(e){e.isDirty()&&(e.save(),g(e))}(e)},400)},h={setup:function(t){t.on("init",function(){l.$render(),l.$setPristine(),l.$setUntouched(),$&&$.$setPristine()}),t.on("ExecCommand change NodeChange ObjectResized",function(){if(!v.debounce)return t.save(),void g(t);p(t)}),t.on("blur",function(){a[0].blur(),l.$setTouched(),e.$$phase||c.$digest()}),t.on("remove",function(){a.remove()}),o.setup&&o.setup(t,{updateView:g}),m.setup&&m.setup(t,{updateView:g})},format:m.format||"html",selector:"#"+s.id};angular.extend(v,o,m,h),n(function(){v.baseURL&&(tinymce.baseURL=v.baseURL);var e=tinymce.init(v);e&&"function"==typeof e.then?e.then(function(){T(c.$eval(s.ngDisabled))}):T(c.$eval(s.ngDisabled))}),l.$formatters.unshift(function(e){return e?r.trustAsHtml(e):""}),l.$parsers.unshift(function(e){return e?r.getTrustedHtml(e):""}),l.$render=function(){w();var e=l.$viewValue?r.getTrustedHtml(l.$viewValue):"";f&&f.getDoc()&&(f.setContent(e),f.fire("change"))},s.$observe("disabled",T);var U=c.$on("$tinymce:refresh",function(e,n){var i=s.id;if(angular.isUndefined(n)||n===i){var r=a.parent(),o=a.clone();o.removeAttr("id"),o.removeAttr("style"),o.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),r.append(t(o)(c)),U()}});c.$on("$destroy",function(){w(),f&&(f.remove(),f=null)})}function T(e){e?(w(),f&&f.getBody().setAttribute("contenteditable",!1)):(w(),f&&!f.settings.readonly&&f.getDoc()&&f.getBody().setAttribute("contenteditable",!0))}function w(){f||(f=tinymce.get(s.id))}}}}]).service("uiTinymceService",[function(){return new function(){var e=0;return{getUniqueId:function(){return"ui-tinymce-"+ ++e}}}}]);